<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>yeobi_easy for KOR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --color-teal: #00BFA5; --font-pretendard: 'Pretendard', sans-serif; }
        body { font-family: var(--font-pretendard); background-color: #F7F9FB; color: #191F28; -webkit-font-smoothing: antialiased; }
        .btn-primary { background-color: var(--color-teal); color: white; transition: all 0.2s; }
        .animate-pulse-attention { animation: pulse 2.5s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // 2026년 여비 규정
        const CONFIG = {
            OUT_DAILY: 25000,   // 관외 일비 인상분
            OUT_MEAL: 25000,    // 관외 식비
            IN_DAILY_LONG: 20000, // 관내 (4시간 이상)
            IN_DAILY_SHORT: 10000, // 관내 (4시간 미만)
            JUSO_KEY: "TESTJUSOGOKR" // 실제 승인키로 교체 필요
        };

        const App = () => {
            const [origin, setOrigin] = useState('');
            const [destination, setDestination] = useState('');
            const [travelType, setTravelType] = useState('OUT');
            const [distance, setDistance] = useState(0);
            const [deductions, setDeductions] = useState({ gov_vehicle: false, short_time: false, meal_count: 0 });
            
            // 주소 검색 관련 상태
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [searchTarget, setSearchTarget] = useState(''); // 'origin' or 'destination'
            const [keyword, setKeyword] = useState('');
            const [searchResults, setSearchResults] = useState([]);

            // 보내주신 특수문자 및 SQL 예약어 체크 로직
            const checkSearchedWord = (word) => {
                if (word.length > 0) {
                    const expText = /[%=><]/;
                    if (expText.test(word)) { alert("특수문자를 입력할 수 없습니다."); return false; }
                    const sqlArray = ["OR", "SELECT", "INSERT", "DELETE", "UPDATE", "CREATE", "DROP", "EXEC", "UNION", "FETCH", "DECLARE", "TRUNCATE"];
                    for (let sql of sqlArray) {
                        const regex = new RegExp(sql, "gi");
                        if (regex.test(word)) { alert(sql + "와 같은 특정문자로 검색할 수 없습니다."); return false; }
                    }
                }
                return true;
            };

            // 주소 API 호출 (JSONP 방식의 현대적 fetch 구현)
            const searchAddr = () => {
                if (!checkSearchedWord(keyword)) return;
                
                const url = `https://business.juso.go.kr/addrlink/addrLinkApi.do?currentPage=1&countPerPage=10&keyword=${encodeURIComponent(keyword)}&confmKey=${CONFIG.JUSO_KEY}&resultType=json`;
                
                fetch(url)
                    .then(res => res.json())
                    .then(json => {
                        if (json.results.common.errorCode !== "0") {
                            alert(json.results.common.errorMessage);
                        } else {
                            setSearchResults(json.results.juso);
                        }
                    })
                    .catch(() => alert("에러가 발생했습니다."));
            };

            const selectAddr = (juso) => {
                // 시/도 + 시/군/구 + 읍/면/동까지만 추출 (전현우 님 요청 반영)
                const addr = `${juso.siNm} ${juso.sggNm} ${juso.emdNm}`.trim();
                if (searchTarget === 'origin') setOrigin(addr);
                else setDestination(addr);
                setIsModalOpen(false);
                setSearchResults([]);
                setKeyword('');
            };

            const costs = (() => {
                let daily = travelType === 'OUT' ? CONFIG.OUT_DAILY : (deductions.short_time ? CONFIG.IN_DAILY_SHORT : CONFIG.IN_DAILY_LONG);
                if (deductions.gov_vehicle) daily = travelType === 'OUT' ? daily / 2 : daily - 10000;
                let meal = travelType === 'OUT' ? CONFIG.OUT_MEAL - (deductions.meal_count * (CONFIG.OUT_MEAL / 3)) : 0;
                const transport = Math.round((1800 + (distance > 10 ? (distance - 10) * 168.6 : 0)) / 100) * 100;
                return { daily, meal, transport: transport * 2, total: daily + meal + (transport * 2) };
            })();

            return (
                <div className="max-w-[480px] mx-auto p-5 min-h-screen relative">
                    <header className="text-center mb-8">
                        <h1 className="text-2xl font-bold text-gray-900">yeobi_easy for KOR</h1>
                        <p className="text-[10px] font-bold text-teal-500 mt-1">2026 교육행정 실무 최적화</p>
                    </header>

                    {/* 주소 입력 및 검색 버튼 */}
                    <div className="space-y-4 mb-6">
                        {['origin', 'destination'].map(target => (
                            <div key={target} className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                                <label className="text-[10px] font-bold text-gray-400 block mb-2">{target === 'origin' ? '출발지' : '목적지'}</label>
                                <div className="flex gap-2">
                                    <input type="text" readOnly className="flex-1 bg-transparent font-bold outline-none" value={target === 'origin' ? origin : destination} placeholder="주소를 검색하세요" />
                                    <button onClick={() => { setIsModalOpen(true); setSearchTarget(target); }} className="px-3 py-1 bg-teal-50 text-teal-600 rounded-lg text-xs font-bold">검색</button>
                                </div>
                            </div>
                        ))}
                        
                        <div className="flex gap-2">
                            {['IN', 'OUT'].map(type => (
                                <button key={type} onClick={() => setTravelType(type)} className={`flex-1 p-3 rounded-xl font-bold text-sm ${travelType === type ? 'bg-teal-500 text-white' : 'bg-gray-100 text-gray-400'}`}>{type === 'IN' ? '관내' : '관외'}</button>
                            ))}
                        </div>

                        <div className="bg-gray-50 p-4 rounded-2xl">
                            <label className="block text-[10px] font-bold text-gray-400 mb-1">편도 거리 (km)</label>
                            <input type="number" className="w-full bg-transparent outline-none font-bold" value={distance} onChange={e => setDistance(parseFloat(e.target.value) || 0)} />
                        </div>
                    </div>

                    {/* 결과 대시보드 */}
                    <div className="bg-[#F7F9FB] p-8 rounded-[32px] text-center border border-gray-100 shadow-xl">
                        <h2 className="text-4xl font-black text-gray-900">{costs.total.toLocaleString()}<span className="text-lg font-medium ml-1">원</span></h2>
                        <div className="mt-6 pt-6 border-t border-dashed border-gray-200 text-xs space-y-2">
                            <div className="flex justify-between"><span>일비</span><span className="font-bold">{costs.daily.toLocaleString()}원</span></div>
                            <div className="flex justify-between"><span>식비</span><span className="font-bold">{costs.meal.toLocaleString()}원</span></div>
                            <div className="flex justify-between"><span>왕복 교통비</span><span className="font-bold">{costs.transport.toLocaleString()}원</span></div>
                        </div>
                    </div>

                    {/* 주소 검색 모달 */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 bg-black/40 backdrop-blur-sm flex items-end sm:items-center justify-center p-4">
                            <div className="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-slide-up">
                                <div className="flex justify-between mb-4">
                                    <h3 className="font-bold">행정구역 검색</h3>
                                    <button onClick={() => setIsModalOpen(false)}>×</button>
                                </div>
                                <div className="flex gap-2 mb-4">
                                    <input type="text" className="flex-1 border-b-2 border-teal-500 outline-none p-2" placeholder="읍/면/동 입력" value={keyword} onChange={e => setKeyword(e.target.value)} onKeyDown={e => e.key === 'Enter' && searchAddr()} />
                                    <button onClick={searchAddr} className="bg-teal-500 text-white px-4 py-2 rounded-xl font-bold">조회</button>
                                </div>
                                <div className="max-h-60 overflow-y-auto space-y-2">
                                    {searchResults.map((j, i) => (
                                        <div key={i} onClick={() => selectAddr(j)} className="p-3 hover:bg-teal-50 cursor-pointer rounded-xl border border-gray-50 text-sm">
                                            <p className="font-bold text-gray-800">{j.siNm} {j.sggNm} {j.emdNm}</p>
                                            <p className="text-[10px] text-gray-400 mt-1">{j.roadAddr}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
