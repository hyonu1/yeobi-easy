<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ïó¨ÎπÑÏù¥ÏßÄÏñ¥_Ïû°Ïä§_ÏóêÎîîÏÖò</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        window.tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'pulse-spread': 'pulse-spread 2s infinite',
                        'slide-up': 'slideUpModal 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    },
                    keyframes: {
                        'pulse-spread': {
                            '0%': { boxShadow: '0 0 0 0 rgba(20, 184, 166, 0.7)' },
                            '70%': { boxShadow: '0 0 0 10px rgba(20, 184, 166, 0)' },
                            '100%': { boxShadow: '0 0 0 0 rgba(20, 184, 166, 0)' },
                        },
                        'slideUpModal': {
                            'from': { transform: 'translateY(30px)', opacity: '0' },
                            'to': { transform: 'translateY(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* FIXED: ÏßÄÎßàÏºìÏÇ∞Ïä§ Î∞è ÌîÑÎ¶¨ÌÖêÎã§Îìú Ìè∞Ìä∏ ÏûÑÌè¨Ìä∏ */
        @import url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.css');
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        :root {
            --font-gmarket: 'GmarketSansMedium', sans-serif;
            --font-pretendard: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            --color-text-main: #191F28;
        }

        body { 
            font-family: var(--font-pretendard);
            background-color: #d1d5db;
            color: var(--color-text-main);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            scrollbar-gutter: stable;
        }

        /* BRUSHED ALUMINUM BACKGROUND - Jobs Era Homage */
        .main-wrapper { 
            width: 440px; 
            min-width: 440px;
            max-width: 440px;
            min-height: 100vh;
            background: #e5e7eb;
            background-image: 
                linear-gradient(rgba(255,255,255,0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.5) 1px, transparent 1px),
                linear-gradient(180deg, #f3f4f6 0%, #9ca3af 100%);
            background-size: 2px 2px, 2px 2px, 100% 100%;
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 0 40px rgba(0,0,0,0.25);
            position: relative;
            box-sizing: border-box;
            border-left: 1px solid #ffffff;
            border-right: 1px solid #777;
        }

        /* Metallic Buttons - Aqua UI Homage */
        .btn-metallic-blue {
            background: linear-gradient(180deg, #4facfe 0%, #0061ff 100%);
            box-shadow: 0 4px 15px rgba(0, 97, 255, 0.3), inset 0 1px 1px rgba(255,255,255,0.5);
            border: 1px solid #0056e0;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: all 0.2s;
            font-family: var(--font-gmarket);
        }
        .btn-metallic-blue:active { transform: scale(0.97); filter: brightness(0.9); }

        .btn-metallic-red {
            background: linear-gradient(180deg, #ff7675 0%, #d63031 100%);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4), inset 0 1px 2px rgba(255,255,255,0.6);
            border: 1px solid #b71c1c;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.4);
            transition: all 0.2s;
            font-family: var(--font-gmarket);
        }
        .btn-metallic-red:active { transform: scale(0.95); filter: brightness(0.85); box-shadow: 0 2px 4px rgba(0,0,0,0.4); }

        .btn-metallic-slate {
            background: linear-gradient(180deg, #94a3b8 0%, #475569 100%);
            box-shadow: 0 4px 15px rgba(71, 85, 105, 0.3), inset 0 1px 1px rgba(255,255,255,0.5);
            border: 1px solid #334155;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: all 0.2s;
            font-family: var(--font-gmarket);
        }
        .btn-metallic-slate:active { transform: scale(0.97); filter: brightness(0.9); }

        .btn-metallic-teal {
            background: linear-gradient(180deg, #2dd4bf 0%, #0d9488 100%);
            box-shadow: 0 4px 15px rgba(13, 148, 136, 0.3), inset 0 1px 1px rgba(255,255,255,0.5);
            border: 1px solid #0f766e;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: all 0.2s;
            font-family: var(--font-gmarket);
        }
        .btn-metallic-teal:active { transform: scale(0.97); filter: brightness(0.9); }

        .iphone-dark-header {
            background: linear-gradient(to bottom, #4c4c4c 0%, #111111 100%);
            border-bottom: 1px solid #000;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
            font-family: var(--font-gmarket);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.8);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .input-group {
            background: #ffffff;
            border-radius: 12px;
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            box-sizing: border-box;
            height: 52px;
            border: 1px solid #cbd5e1;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.04);
            font-family: var(--font-gmarket);
        }

        .tag-side {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 800;
            background-color: #f1f5f9;
            color: #64748B;
            border: 1px solid #E2E8F0;
            margin-left: 8px;
            white-space: nowrap;
            font-family: var(--font-pretendard);
        }

        .tag-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            background-color: #ffffff;
            color: #475569;
            border: 1px solid #cbd5e1;
            margin: 0 2px;
            font-family: var(--font-gmarket);
        }
        .tag-badge-dark { background-color: #334155; color: #FFFFFF; border: none; }

        .detail-drawer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            background-color: #ffffff;
            position: relative;
        }
        .detail-drawer::before {
            content: '';
            position: absolute;
            top: -6px; left: 0; right: 0;
            height: 12px;
            background: radial-gradient(circle, transparent 0.25em, #ffffff 0.3em);
            background-size: 1em 1em;
            background-position: 0.5em 0;
            transform: rotate(180deg);
        }
        .detail-drawer.open { max-height: 2000px; }

        input.ship-fare-input { 
            text-align: right; background-color: transparent; width: 100px; 
            font-family: var(--font-gmarket); font-weight: 700; outline: none; 
            border-bottom: 2px solid #E2E8F0; padding: 0 2px; color: #191F28; 
            font-size: 18px;
        }

        .deduct-btn {
            position: absolute;
            left: 50%; top: 50%;
            transform: translate(-50%, -50%);
            font-size: 11px; 
            padding: 4px 12px; 
            border-radius: 8px; 
            font-weight: 700;
            border: 1px solid #cbd5e1; 
            background: #f8fafc; 
            color: #64748B; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            cursor: pointer;
            z-index: 10;
            font-family: var(--font-gmarket);
        }
        .deduct-btn.active { background: #ffffff; color: #EF4444; border-color: #EF4444; }

        .suggestions-box {
            position: absolute; left: 0; right: 0; top: 100%;
            background: white; border: 1px solid #E5E7EB;
            border-radius: 0 0 12px 12px; z-index: 999;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            max-height: 240px; overflow-y: auto;
            font-family: var(--font-gmarket);
        }
        .suggestion-item {
            padding: 12px 16px; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 15px; color: #374151; font-weight: 500;
            transition: background-color 0.15s ease;
        }
        .suggestion-item:hover, .suggestion-item.active { background-color: #F0FDFA; }

        @keyframes wiggle { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } }
        .icon-wiggle { display: inline-block; animation: wiggle 1.5s ease-in-out infinite; transform-origin: bottom center; margin-left: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icons = {
            MapPin: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Search: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            ChevronDown: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m6 9 6 6 6-6"/></svg>,
            X: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Info: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="16" y2="12"/><line x1="12" x2="12.01" y1="8" y2="8"/></svg>
        };

        const CHOSUNG = ["„Ñ±","„Ñ≤","„Ñ¥","„Ñ∑","„Ñ∏","„Ñπ","„ÖÅ","„ÖÇ","„ÖÉ","„ÖÖ","„ÖÜ","„Öá","„Öà","„Öâ","„Öä","„Öã","„Öå","„Öç","„Öé"];
        const COMPLEX_JAMO_MAP = {'„Ñ≥':'„Ñ±„ÖÖ','„Ñµ':'„Ñ¥„Öà','„Ñ∂':'„Ñ¥„Öé','„Ñ∫':'„Ñπ„Ñ±','„Ñª':'„Ñπ„ÖÅ','„Ñº':'„Ñπ„ÖÇ','„ÑΩ':'„Ñπ„ÖÖ','„Ñæ':'„Ñπ„Öå','„Ñø':'„Ñπ„Öç','„ÖÄ':'„Ñπ„Öé','„ÖÑ':'„ÖÇ„ÖÖ'};

        const getChosung = (str) => {
            if (!str) return "";
            let result = "";
            for (let i = 0; i < str.length; i++) {
                const code = str.charCodeAt(i) - 44032;
                if (code > -1 && code < 11172) result += CHOSUNG[Math.floor(code / 588)];
                else result += str.charAt(i);
            }
            return result;
        };
        const resolveComplexJamo = (str) => !str ? "" : str.split('').map(char => COMPLEX_JAMO_MAP[char] || char).join('');
        const normalize = (text) => {
            if (!text) return "";
            if (text.includes("Íµ∞Ïô∏")) return "Íµ∞Ïô∏"; 
            return text.replace(/(Ïãú|Íµ∞|Ïùç|Î©¥|ÌÑ∞ÎØ∏ÎÑê|Ï¢ÖÌï©|Í≥µÏö©|\s)/g, "");
        };
        const fmt = (num) => (num !== undefined && num !== null) ? num.toLocaleString() : '0';

        const ALLOWED_CITIES = [
            "Í¥ëÏ£º", "ÎÇ®ÏïÖ", "Î™©Ìè¨", "Ïó¨Ïàò", "ÏàúÏ≤ú", "ÎÇòÏ£º", "Í¥ëÏñë", "Îã¥Ïñë", "Í≥°ÏÑ±", "Íµ¨Î°Ä", "Í≥†Ìù•", "Î≥¥ÏÑ±",
            "ÌôîÏàú", "Ïû•Ìù•", "Í∞ïÏßÑ", "Ìï¥ÎÇ®", "ÏòÅÏïî", "Î¨¥Ïïà", "Ìï®Ìèâ", "ÏòÅÍ¥ë", "Ïû•ÏÑ±", "ÏôÑÎèÑ", "ÏßÑÎèÑ", "Ïã†Ïïà", "Ïã†ÏïàÍµêÏú°Ï≤≠",
            "ÏïïÌï¥", "ÏßÄÎèÑ", "Ï¶ùÎèÑ", "ÏûÑÏûê", "ÌåîÍ∏à", "ÏïîÌÉú", "ÏûêÏùÄ", "ÏïàÏ¢å", "Ïû•ÏÇ∞", "ÌïòÏùò", "Ïã†Ïùò", 
            "ÌùëÏÇ∞", "ÎπÑÍ∏à", "ÎèÑÏ¥à", "Ï≤≠ÏÇ∞", "ÎÖ∏Ìôî", "ÏÜåÏïà", "Ïó¨ÏÑúÎèÑ", "Í∏àÏùº", 
            "ÏÉùÏùº", "Î≥¥Í∏∏", "Í∏àÎãπ", "Íµ∞Ïô∏", "Ïã†ÏßÄ", "Í≥†Í∏à", "ÏïΩÏÇ∞", 
            "ÌôçÎèÑ", "Í∞ÄÍ±∞ÎèÑ", "ÎßåÏû¨ÎèÑ", "ÏßÑÎèÑÏ°∞ÎèÑ", "ÏßÑÎèÑÍ¥ÄÎß§ÎèÑ", "ÏßÑÎèÑÏÑúÍ±∞Ï∞®ÎèÑ",
            "Í≥†Ìù•ÎìùÎüâÎèÑ", "Í≥†Ìù•Ïë•ÏÑ¨(Ïï†ÎèÑ)", "ÏòÅÍ¥ëÏïàÎßàÎèÑ", "ÏòÅÍ¥ëÎÇôÏõî", "ÏòÅÍ¥ëÏÜ°Ïù¥ÎèÑ", "Ìï¥ÎÇ®Ïñ¥Î£°ÎèÑ"
        ];

        const REGION_ICONS = {
            "Í¥ëÏ£º": "üçâ", "Î™©Ìè¨": "‚öì", "Ïó¨Ïàò": "üé§", "ÏàúÏ≤ú": "üåæ", "ÎÇòÏ£º": "üçê", "Í¥ëÏñë": "‚öΩ", "Îã¥Ïñë": "üéã", "Í≥°ÏÑ±": "üöÇ", "Íµ¨Î°Ä": "üêª", "Í≥†Ìù•": "üöÄ", "Î≥¥ÏÑ±": "üçµ", "ÌôîÏàú": "ü™®", "Ïû•Ìù•": "üçÑ", "Í∞ïÏßÑ": "üè∫", "Ìï¥ÎÇ®": "ü¶ñ", "ÏòÅÏïî": "üèéÔ∏è", "Î¨¥Ïïà": "üßÖ", "Ìï®Ìèâ": "ü¶ã", "ÏòÅÍ¥ë": "üêü", "Ïû•ÏÑ±": "üçÇ", "ÏôÑÎèÑ": "ü¶™", "ÏßÑÎèÑ": "üêï", "Ïã†Ïïà": "ü™Ω", "Ïã†ÏïàÍµêÏú°Ï≤≠": "üèõÔ∏è", "ÎÇ®ÏïÖ": "üèõÔ∏è", 
            "ÏßÄÎèÑ": "üßÇ", "ÏïïÌï¥": "üêô", "Ï¶ùÎèÑ": "üö≤", "ÏûÑÏûê": "üå∑", "ÏûêÏùÄ": "üèñÔ∏è", "ÏïàÏ¢å": "üòà", "ÌåîÍ∏à": "ü¶ê", "ÏïîÌÉú": "üåÅ", "ÎπÑÍ∏à": "ü¶Ö", "ÎèÑÏ¥à": "üåø", "ÌùëÏÇ∞": "üêü", "ÌïòÏùò": "üïäÔ∏è", "Ïã†Ïùò": "üßÇ", "Ïû•ÏÇ∞": "üèîÔ∏è",
            "Ï≤≠ÏÇ∞": "üêå", "ÎÖ∏Ìôî": "ü¶™", "ÏÜåÏïà": "üá∞üá∑", "Ïó¨ÏÑúÎèÑ": "üé£", "Í∏àÏùº": "üåä", "ÏÉùÏùº": "üéÇ", "Î≥¥Í∏∏": "üìú", "Í∏àÎãπ": "üóø", "Íµ∞Ïô∏": "Bridge", "Ïã†ÏßÄ": "üèñÔ∏è", "Í≥†Í∏à": "üö¢", "ÏïΩÏÇ∞": "Goat",
            "ÌôçÎèÑ": "üåÖ", "Í∞ÄÍ±∞ÎèÑ": "üèùÔ∏è", "ÎßåÏû¨ÎèÑ": "üé£", "ÏßÑÎèÑÏ°∞ÎèÑ": "Eagle", "ÏßÑÎèÑÏÑúÍ±∞Ï∞®ÎèÑ": "Ship", "ÏßÑÎèÑÍ¥ÄÎß§ÎèÑ": "Tree",
            "Í≥†Ìù•ÎìùÎüâÎèÑ": "Rice", "Í≥†Ìù•Ïë•ÏÑ¨(Ïï†ÎèÑ)": "Cat", "ÏòÅÍ¥ëÏïàÎßàÎèÑ": "Horse", "ÏòÅÍ¥ëÎÇôÏõî": "Moon", "ÏòÅÍ¥ëÏÜ°Ïù¥ÎèÑ": "Shell", "Ìï¥ÎÇ®Ïñ¥Î£°ÎèÑ": "Dragon"
        };

        const ISLAND_DB = {
            "Ïã†Ïïà": { hub: "Î™©Ìè¨", cost: 0, type: "connected" },
            "Ïã†ÏïàÍµêÏú°Ï≤≠": { hub: "Î™©Ìè¨", cost: 0, type: "connected" },
            "ÏïïÌï¥": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" },
            "ÏßÄÎèÑ": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" },
            "Ï¶ùÎèÑ": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" },
            "ÏûÑÏûê": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" },
            "ÌåîÍ∏à": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" },
            "ÏïîÌÉú": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" },
            "ÏûêÏùÄ": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" },
            "ÏïàÏ¢å": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 2000, type: "connected" },
            "ÎπÑÍ∏à": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨, ÏïîÌÉú", cost: 2000, shipCost: 1000, type: "ship", special: true },
            "ÎèÑÏ¥à": { hub: "Î™©Ìè¨", via: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship", special: true },
            "Ïû•ÏÇ∞": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" },
            "ÌïòÏùò": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" },
            "Ïã†Ïùò": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" },
            "ÌùëÏÇ∞": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" },
            "ÌôçÎèÑ": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" },
            "Í∞ÄÍ±∞ÎèÑ": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" },
            "ÎßåÏû¨ÎèÑ": { hub: "Î™©Ìè¨", cost: 0, shipCost: 1000, type: "ship" },
            "ÏôÑÎèÑ": { hub: "ÏôÑÎèÑ", cost: 0, type: "connected", special: true }, 
            "Íµ∞Ïô∏": { hub: "ÏôÑÎèÑ", cost: 0, type: "connected", special: true }, 
            "Ïã†ÏßÄ": { hub: "ÏôÑÎèÑ", cost: 0, type: "connected", special: true },
            "Í≥†Í∏à": { hub: "ÏôÑÎèÑ", cost: 0, type: "connected", special: true },
            "ÏïΩÏÇ∞": { hub: "ÏôÑÎèÑ", cost: 0, type: "connected", special: true },
            "Ï≤≠ÏÇ∞": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" },
            "ÎÖ∏Ìôî": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" },
            "Î≥¥Í∏∏": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" },
            "ÏÜåÏïà": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" },
            "Ïó¨ÏÑúÎèÑ": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" },
            "Í∏àÏùº": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" },
            "ÏÉùÏùº": { hub: "ÏôÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" },
            "ÏßÑÎèÑÏ°∞ÎèÑ": { hub: "ÏßÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" },
            "ÏßÑÎèÑÍ¥ÄÎß§ÎèÑ": { hub: "ÏßÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" },
            "ÏßÑÎèÑÏÑúÍ±∞Ï∞®ÎèÑ": { hub: "ÏßÑÎèÑ", cost: 0, shipCost: 1000, type: "ship" },
            "Í≥†Ìù•ÎìùÎüâÎèÑ": { hub: "Í≥†Ìù•", cost: 0, shipCost: 1000, type: "ship" },
            "Í≥†Ìù•Ïë•ÏÑ¨(Ïï†ÎèÑ)": { hub: "Í≥†Ìù•", cost: 0, shipCost: 1000, type: "ship" },
            "ÏòÅÍ¥ëÏïàÎßàÎèÑ": { hub: "ÏòÅÍ¥ë", cost: 0, type: "ship" },
            "ÏòÅÍ¥ëÎÇôÏõî": { hub: "ÏòÅÍ¥ë", cost: 0, type: "ship" },
            "ÏòÅÍ¥ëÏÜ°Ïù¥ÎèÑ": { hub: "ÏòÅÍ¥ë", cost: 0, type: "ship" },
            "Í∏àÎãπ": { hub: "Ïû•Ìù•", cost: 0, shipCost: 1000, type: "ship" },
            "Ìï¥ÎÇ®Ïñ¥Î£°ÎèÑ": { hub: "Ìï¥ÎÇ®", cost: 0, shipCost: 1000, type: "ship" }
        };

        const SAME_AREA_GROUPS = [
            new Set(["Î™©Ìè¨", "Ïã†Ïïà", "Ïã†ÏïàÍµêÏú°Ï≤≠"]), new Set(["ÎÖ∏Ìôî", "Î≥¥Í∏∏"]), new Set(["ÎπÑÍ∏à", "ÎèÑÏ¥à"]),
            new Set(["ÏïïÌï¥", "ÏûêÏùÄ", "ÌåîÍ∏à", "ÏïîÌÉú", "ÏïàÏ¢å", "ÏûÑÏûê", "ÏßÄÎèÑ", "Ï¶ùÎèÑ"]),
            new Set(["Íµ∞Ïô∏", "ÏôÑÎèÑ", "Í≥†Í∏à", "ÏïΩÏÇ∞", "Ïã†ÏßÄ", "Í∏àÎãπ"])
        ];

        const POPUP_REGIONS = {
            "Ïã†Ïïà": ["Ïã†ÏïàÍµêÏú°Ï≤≠", "ÏßÄÎèÑ", "ÏïïÌï¥", "Ï¶ùÎèÑ", "ÏûÑÏûê", "ÏûêÏùÄ", "ÏïàÏ¢å", "ÌåîÍ∏à", "ÏïîÌÉú", "ÎπÑÍ∏à", "ÎèÑÏ¥à", "ÌùëÏÇ∞", "ÌïòÏùò", "Ïã†Ïùò", "Ïû•ÏÇ∞", "ÌôçÎèÑ", "Í∞ÄÍ±∞ÎèÑ", "ÎßåÏû¨ÎèÑ"],
            "ÏôÑÎèÑ": ["ÏôÑÎèÑ", "Í∏àÏùº", "ÎÖ∏Ìôî", "Íµ∞Ïô∏", "Ïã†ÏßÄ", "Í≥†Í∏à", "ÏïΩÏÇ∞", "Ï≤≠ÏÇ∞", "ÏÜåÏïà", "Í∏àÎãπ", "Î≥¥Í∏∏", "ÏÉùÏùº", "Ïó¨ÏÑúÎèÑ"]
        };

        const AutocompleteInput = ({ value, onChange, onSelect, placeholder, cityList, onEnter }) => {
            const [suggestions, setSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [activeIndex, setActiveIndex] = useState(-1);

            useEffect(() => {
                const inputVal = (value || '').trim();
                if (!inputVal || cityList.includes(inputVal)) { setSuggestions([]); return; }
                const resolved = resolveComplexJamo(inputVal);
                const isChosung = /^[„Ñ±-„Öé]+$/.test(resolved); 
                let exact = cityList.filter(city => {
                    if (isChosung) return getChosung(city).includes(resolved);
                    return city.includes(inputVal);
                });
                setSuggestions(exact.length > 0 ? exact : []);
            }, [value, cityList]);

            const handleSelect = (city) => { onSelect(city); setShowSuggestions(false); setSuggestions([]); setActiveIndex(-1); };
            const handleInputClick = () => { if (value) { onChange(''); onSelect(''); } };

            const handleKeyDown = (e) => {
                if (e.key === 'Tab') return; 
                if (e.key === 'ArrowDown') { 
                    e.preventDefault(); 
                    if (suggestions.length > 0) setActiveIndex(prev => (prev < suggestions.length - 1 ? prev + 1 : 0)); 
                }
                else if (e.key === 'ArrowUp') { 
                    e.preventDefault(); 
                    if (suggestions.length > 0) setActiveIndex(prev => (prev > 0 ? prev - 1 : suggestions.length - 1)); 
                }
                else if (e.key === 'Enter') {
                    if (e.nativeEvent.isComposing) return;
                    if (activeIndex >= 0 && suggestions.length > 0) handleSelect(suggestions[activeIndex]);
                    else if (suggestions.length > 0) handleSelect(suggestions[0]);
                    else if (onEnter) onEnter(); 
                    e.target.blur();
                }
            };

            return (
                <div className="relative w-full">
                    <div className="input-group">
                        <Icons.MapPin className="text-gray-400 shrink-0" size={18} />
                        <input type="text" className="flex-1 bg-transparent outline-none font-bold text-gray-800 text-lg placeholder-gray-300" placeholder={placeholder} value={value || ''} onChange={e => { onChange(e.target.value); setShowSuggestions(true); }} onClick={handleInputClick} onFocus={() => setShowSuggestions(true)} onBlur={() => setTimeout(() => setShowSuggestions(false), 200)} onKeyDown={handleKeyDown} autoComplete="off" />
                        {value && REGION_ICONS[value.replace(/\s/g, "")] && <span className="text-xl icon-wiggle">{REGION_ICONS[value.replace(/\s/g, "")]}</span>}
                    </div>
                    {showSuggestions && suggestions.length > 0 && (
                        <div className="suggestions-box custom-scroll">
                            {suggestions.map((city, idx) => (
                                <div key={city} 
                                     onMouseDown={(e) => { e.preventDefault(); handleSelect(city); }} 
                                     onMouseEnter={() => setActiveIndex(idx)} 
                                     className={`suggestion-item ${idx === activeIndex ? 'active bg-teal-100' : 'hover:bg-teal-50'}`}>
                                    <span>{city}</span>
                                    <span>{REGION_ICONS[city.replace(/\s/g, "")]}</span>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const Toggle = ({ checked, onChange }) => (
            <button onClick={() => onChange(!checked)} className={`w-10 h-5 rounded-full transition-colors relative ${checked ? 'bg-blue-500' : 'bg-gray-300'}`}>
                <span className={`absolute top-0.5 left-0.5 bg-white w-4 h-4 rounded-full transition-transform shadow-sm ${checked ? 'translate-x-5' : 'translate-x-0'}`} />
            </button>
        );

        const App = () => {
            const [origin, setOrigin] = useState('');
            const [destination, setDestination] = useState('');
            const [result, setResult] = useState(null);
            const [busDataState, setBusDataState] = useState({});
            const [modalState, setModalState] = useState({ type: null, data: [] });
            const [showDetail, setShowDetail] = useState(false);
            const [shipFare, setShipFare] = useState(0); 
            const [customTransport, setCustomTransport] = useState('');
            const [manualMainTransport, setManualMainTransport] = useState(null); 
            const [intraCityOpen, setIntraCityOpen] = useState(false);
            const [intraDeductions, setIntraDeductions] = useState({ shortTime: false, govVehicle: false });
            const [activeModal, setActiveModal] = useState(null); 
            const [deductions, setDeductions] = useState({ gov_vehicle: false, meal_1: false, meal_2: false, meal_3: false, meal_half: false, transport_proof: false, transport_gov_vehicle: false, transport_passenger: false });
            const [isHeaderVisible, setIsHeaderVisible] = useState(true);

            useEffect(() => {
                const handleScroll = () => {
                    if (window.scrollY > 0) { setIsHeaderVisible(false); } 
                    else { setIsHeaderVisible(true); }
                };
                window.addEventListener('scroll', handleScroll);
                const INITIAL_DATA = {
                    "Í¥ëÏ£º": { "Î™©Ìè¨": { gen: 7200, pre: 9300 }, "Ïó¨Ïàò": { gen: 13000, pre: 16800 }, "ÏàúÏ≤ú": { gen: 8400, pre: 11000 }, "ÎÇòÏ£º": { gen: 4300 }, "Í¥ëÏñë": { gen: 8400, pre: 10900 }, "Îã¥Ïñë": { gen: 2900 }, "Í≥°ÏÑ±": { gen: 5500 }, "Íµ¨Î°Ä": { gen: 9800 }, "Í≥†Ìù•": { gen: 16200, pre: 21000 }, "Î≥¥ÏÑ±": { gen: 10500, pre: 11500 }, "ÌôîÏàú": { gen: 2500 }, "Ïû•Ìù•": { gen: 11500, pre: 14900 }, "Í∞ïÏßÑ": { gen: 11700, pre: 15200 }, "Ìï¥ÎÇ®": { gen: 13700, pre: 16900 }, "ÏòÅÏïî": { gen: 8700 }, "Î¨¥Ïïà": { gen: 6000, pre: 7800 }, "Ìï®Ìèâ": { gen: 4500, pre: 5800 }, "ÏòÅÍ¥ë": { gen: 7300, pre: 9500 }, "Ïû•ÏÑ±": { gen: 2400 }, "ÏôÑÎèÑ": { gen: 20500, pre: 24800 }, "ÏßÑÎèÑ": { gen: 15300, pre: 19900 }, "ÎÇ®ÏïÖ": { gen: 7200, pre: 9300 } },
                    "Î™©Ìè¨": { "Í¥ëÏ£º": { gen: 7200, pre: 9300 }, "Ïó¨Ïàò": { gen: 16500, pre: 21400 }, "ÏàúÏ≤ú": { gen: 11500, pre: 15000 }, "ÎÇòÏ£º": { gen: 7300 }, "Í¥ëÏñë": { gen: 13700, pre: 17800 }, "Îã¥Ïñë": { gen: 10100 }, "Í≥°ÏÑ±": { gen: 12700 }, "Íµ¨Î°Ä": { gen: 17000 }, "Í≥†Ìù•": { gen: 18600 }, "Î≥¥ÏÑ±": { gen: 13500 }, "ÌôîÏàú": { gen: 9700 }, "Ïû•Ìù•": { gen: 10200 }, "Í∞ïÏßÑ": { gen: 7800 }, "Ìï¥ÎÇ®": { gen: 8700 }, "ÏòÅÏïî": { gen: 6400 }, "Î¨¥Ïïà": { gen: 3200 }, "Ìï®Ìèâ": { gen: 5100 }, "ÏòÅÍ¥ë": { gen: 8700 }, "Ïû•ÏÑ±": { gen: 9600 }, "ÏôÑÎèÑ": { gen: 15700 }, "ÏßÑÎèÑ": { gen: 8300, pre: 10800 }, "ÎÇ®ÏïÖ": { gen: 1700 } },
                    "Ïó¨Ïàò": { "Í¥ëÏ£º": { gen: 13000, pre: 16800 }, "Î™©Ìè¨": { gen: 16500, pre: 21400 }, "ÏàúÏ≤ú": { gen: 5000 }, "ÎÇòÏ£º": { gen: 17300 }, "Í¥ëÏñë": { gen: 7500 }, "Îã¥Ïñë": { gen: 15900 }, "Í≥°ÏÑ±": { gen: 18500 }, "Íµ¨Î°Ä": { gen: 10200 }, "Í≥†Ìù•": { gen: 13600 }, "Î≥¥ÏÑ±": { gen: 12800 }, "ÌôîÏàú": { gen: 15500 }, "Ïû•Ìù•": { gen: 16100 }, "Í∞ïÏßÑ": { gen: 18500 }, "Ìï¥ÎÇ®": { gen: 21500 }, "ÏòÅÏïî": { gen: 22400 }, "Î¨¥Ïïà": { gen: 19000 }, "Ìï®Ìèâ": { gen: 17500 }, "ÏòÅÍ¥ë": { gen: 20300 }, "Ïû•ÏÑ±": { gen: 15400 }, "ÏôÑÎèÑ": { gen: 28200 }, "ÏßÑÎèÑ": { gen: 24800 }, "ÎÇ®ÏïÖ": { gen: 15600, pre: 20200 } },
                    "ÏàúÏ≤ú": { "Í¥ëÏ£º": { gen: 8400, pre: 11000 }, "Î™©Ìè¨": { gen: 11500, pre: 15000 }, "Ïó¨Ïàò": { gen: 5000 }, "ÎÇòÏ£º": { gen: 12700 }, "Í¥ëÏñë": { gen: 2500 }, "Îã¥Ïñë": { gen: 10100 }, "Í≥°ÏÑ±": { gen: 9400 }, "Íµ¨Î°Ä": { gen: 5200 }, "Í≥†Ìù•": { gen: 8700 }, "Î≥¥ÏÑ±": { gen: 7900 }, "ÌôîÏàú": { gen: 9700 }, "Ïû•Ìù•": { gen: 11100 }, "Í∞ïÏßÑ": { gen: 13500 }, "Ìï¥ÎÇ®": { gen: 16600 }, "ÏòÅÏïî": { gen: 17500 }, "Î¨¥Ïïà": { gen: 14700, pre: 18200 }, "Ìï®Ìèâ": { gen: 12900 }, "ÏòÅÍ¥ë": { gen: 15700 }, "Ïû•ÏÑ±": { gen: 10800 }, "ÏôÑÎèÑ": { gen: 23200 }, "ÏßÑÎèÑ": { gen: 23900 }, "ÎÇ®ÏïÖ": { gen: 10600, pre: 13800 } },
                    "ÎÇòÏ£º": { "Í¥ëÏ£º": { gen: 4300 }, "Î™©Ìè¨": { gen: 7300 }, "Ïó¨Ïàò": { gen: 17300 }, "ÏàúÏ≤ú": { gen: 12700 }, "Í¥ëÏñë": { gen: 12700 }, "Îã¥Ïñë": { gen: 7200 }, "Í≥°ÏÑ±": { gen: 9800 }, "Íµ¨Î°Ä": { gen: 14100 }, "Í≥†Ìù•": { gen: 20500 }, "Î≥¥ÏÑ±": { gen: 14800 }, "ÌôîÏàú": { gen: 6800 }, "Ïû•Ìù•": { gen: 9000 }, "Í∞ïÏßÑ": { gen: 8200 }, "Ìï¥ÎÇ®": { gen: 9900 }, "ÏòÅÏïî": { gen: 4400 }, "Î¨¥Ïïà": { gen: 4100 }, "Ìï®Ìèâ": { gen: 3700 }, "ÏòÅÍ¥ë": { gen: 7400 }, "Ïû•ÏÑ±": { gen: 6700 }, "ÏôÑÎèÑ": { gen: 16600 }, "ÏßÑÎèÑ": { gen: 17200 }, "ÎÇ®ÏïÖ": { gen: 9000 } },
                    "Í¥ëÏñë": { "Í¥ëÏ£º": { gen: 8400, pre: 10900 }, "Î™©Ìè¨": { gen: 13700, pre: 17800 }, "Ïó¨Ïàò": { gen: 7500 }, "ÏàúÏ≤ú": { gen: 2500 }, "ÎÇòÏ£º": { gen: 12700 }, "Îã¥Ïñë": { Ï†ïÎ≥¥: 11300 }, "Í≥°ÏÑ±": { gen: 13900 }, "Íµ¨Î°Ä": { gen: 7700 }, "Í≥†Ìù•": { gen: 10200 }, "Î≥¥ÏÑ±": { gen: 9900 }, "ÌôîÏàú": { gen: 10900 }, "Ïû•Ìù•": { gen: 13200 }, "Í∞ïÏßÑ": { gen: 15600 }, "Ìï¥ÎÇ®": { gen: 19100 }, "ÏòÅÏïî": { gen: 19500 }, "Î¨¥Ïïà": { gen: 6000 }, "Ìï®Ìèâ": { gen: 4500 }, "ÏòÅÍ¥ë": { gen: 7300 }, "Ïû•ÏÑ±": { gen: 2400 }, "ÏôÑÎèÑ": { gen: 20500 }, "ÏßÑÎèÑ": { gen: 15300 }, "ÎÇ®ÏïÖ": { gen: 7200 } },
                    "Îã¥Ïñë": { "Í¥ëÏ£º": { gen: 2900 }, "Î™©Ìè¨": { gen: 10100 }, "Ïó¨Ïàò": { Ï†ïÎ≥¥: 15900 }, "ÏàúÏ≤ú": { gen: 10100 }, "ÎÇòÏ£º": { gen: 11300 }, "Í¥ëÏñë": { gen: 11300 }, "Í≥°ÏÑ±": { gen: 8400 }, "Íµ¨Î°Ä": { gen: 12700 }, "Í≥†Ìù•": { gen: 19100 }, "Î≥¥ÏÑ±": { gen: 13400 }, "ÌôîÏàú": { gen: 8000 }, "Ïû•Ìù•": { gen: 14400 }, "Í∞ïÏßÑ": { gen: 14600 }, "Ìï¥ÎÇ®": { gen: 16600 }, "ÏòÅÏïî": { gen: 11600 }, "Î¨¥Ïïà": { gen: 8900 }, "Ìï®Ìèâ": { gen: 7400 }, "ÏòÅÍ¥ë": { gen: 10200 }, "Ïû•ÏÑ±": { gen: 5300 }, "ÏôÑÎèÑ": { gen: 23400 }, "ÏßÑÎèÑ": { gen: 18200 }, "ÎÇ®ÏïÖ": { gen: 10100 } },
                    "Í≥°ÏÑ±": { "Í¥ëÏ£º": { gen: 5500 }, "Î™©Ìè¨": { gen: 12700 }, "Ïó¨Ïàò": { gen: 18500 }, "ÏàúÏ≤ú": { gen: 9800 }, "ÎÇòÏ£º": { gen: 9800 }, "Í¥ëÏñë": { gen: 13900 }, "Îã¥Ïñë": { gen: 8400 }, "Íµ¨Î°Ä": { gen: 4300 }, "Í≥†Ìù•": { gen: 21400 }, "Î≥¥ÏÑ±": { gen: 17300 }, "ÌôîÏàú": { gen: 8000 }, "Ïû•Ìù•": { gen: 17000 }, "Í∞ïÏßÑ": { gen: 2400 }, "Ìï¥ÎÇ®": { gen: 19200 }, "ÏòÅÏïî": { gen: 14200 }, "Î¨¥Ïïà": { gen: 11500 }, "Ìï®Ìèâ": { gen: 8800 }, "ÏòÅÍ¥ë": { gen: 12800 }, "Ïû•ÏÑ±": { gen: 7900 }, "ÏôÑÎèÑ": { gen: 23000 }, "ÏßÑÎèÑ": { gen: 20800 }, "ÎÇ®ÏïÖ": { gen: 12700 } },
                    "Íµ¨Î°Ä": { "Í¥ëÏ£º": { gen: 9800 }, "Î™©Ìè¨": { gen: 17000 }, "Ïó¨Ïàò": { gen: 10200 }, "ÏàúÏ≤ú": { gen: 5200 }, "ÎÇòÏ£º": { gen: 14100 }, "Í¥ëÏñë": { gen: 7700 }, "Îã¥Ïñë": { gen: 12700 }, "Í≥°ÏÑ±": { gen: 4300 }, "Í≥†Ìù•": { gen: 21400 }, "Î≥¥ÏÑ±": { gen: 17300 }, "ÌôîÏàú": { gen: 8000 }, "Ïû•Ìù•": { gen: 17000 }, "Í∞ïÏßÑ": { gen: 11400 }, "Ìï¥ÎÇ®": { gen: 13700 }, "ÏòÅÏïî": { gen: 8700 }, "Î¨¥Ïïà": { gen: 6000 }, "Ìï®Ìèâ": { gen: 4500 }, "ÏòÅÍ¥ë": { gen: 7300 }, "Ïû•ÏÑ±": { gen: 2400 }, "ÏôÑÎèÑ": { gen: 20500 }, "ÏßÑÎèÑ": { gen: 15300 }, "ÎÇ®ÏïÖ": { gen: 7200 } },
                    "Í≥†Ìù•": { "Í¥ëÏ£º": { gen: 16200, pre: 21000 }, "Î™©Ìè¨": { gen: 18600 }, "Ïó¨Ïàò": { gen: 13600 }, "ÏàúÏ≤ú": { gen: 8700 }, "ÎÇòÏ£º": { gen: 20500 }, "Í¥ëÏñë": { gen: 10200 }, "Îã¥Ïñë": { gen: 19100 }, "Í≥°ÏÑ±": { gen: 21400 }, "Íµ¨Î°Ä": { gen: 13900 }, "Î≥¥ÏÑ±": { gen: 9900 }, "ÌôîÏàú": { gen: 13700 }, "Ïû•Ìù•": { gen: 13100 }, "Í∞ïÏßÑ": { gen: 14200 }, "Ìï¥ÎÇ®": { gen: 18600 }, "ÏòÅÏïî": { gen: 19500 }, "Î¨¥Ïïà": { gen: 22200 }, "Ìï®Ìèâ": { gen: 20700 }, "ÏòÅÍ¥ë": { gen: 23500 }, "Ïû•ÏÑ±": { gen: 18600 }, "ÏôÑÎèÑ": { gen: 25200 }, "ÏßÑÎèÑ": { gen: 25900 }, "ÎÇ®ÏïÖ": { gen: 23400 } },
                    "Î≥¥ÏÑ±": { "Í¥ëÏ£º": { gen: 10500, pre: 11500 }, "Î™©Ìè¨": { gen: 13500 }, "Ïó¨Ïàò": { gen: 12800 }, "ÏàúÏ≤ú": { gen: 7900 }, "ÎÇòÏ£º": { gen: 14800 }, "Í¥ëÏñë": { gen: 9900 }, "Îã¥Ïñë": { gen: 13400 }, "Í≥°ÏÑ±": { gen: 17300 }, "Íµ¨Î°Ä": { gen: 13100 }, "Í≥†Ìù•": { gen: 9900 }, "ÌôîÏàú": { gen: 7800 }, "Ïû•Ìù•": { gen: 3200 }, "Í∞ïÏßÑ": { gen: 5700 }, "Ìï¥ÎÇ®": { gen: 8700 }, "ÏòÅÏïî": { gen: 7800 }, "Î¨¥Ïïà": { gen: 16700 }, "Ìï®Ìèâ": { gen: 15000 }, "ÏòÅÍ¥ë": { gen: 17800 }, "Ïû•ÏÑ±": { gen: 12900 }, "ÏôÑÎèÑ": { gen: 15400 }, "ÏßÑÎèÑ": { gen: 16000 }, "ÎÇ®ÏïÖ": { gen: 13500 } },
                    "ÌôîÏàú": { "Í¥ëÏ£º": { gen: 2500 }, "Î™©Ìè¨": { gen: 9700 }, "Ïó¨Ïàò": { gen: 15500 }, "ÏàúÏ≤ú": { gen: 9700 }, "ÎÇòÏ£º": { Ï†ïÎ≥¥: 6800 }, "Í¥ëÏñë": { Ï†ïÎ≥¥: 8000 }, "Îã¥Ïñë": { Ï†ïÎ≥¥: 8000 }, "Í≥°ÏÑ±": { gen: 8000 }, "Íµ¨Î°Ä": { gen: 12300 }, "Í≥†Ìù•": { gen: 13700 }, "Î≥¥ÏÑ±": { gen: 7800 }, "Ïû•Ìù•": { gen: 10000 }, "Í∞ïÏßÑ": { gen: 11400 }, "Ìï¥ÎÇ®": { gen: 16500 }, "ÏòÅÏïî": { gen: 11200 }, "Î¨¥Ïïà": { gen: 8500 }, "Ìï®Ìèâ": { gen: 7000 }, "ÏòÅÍ¥ë": { gen: 9800 }, "Ïû•ÏÑ±": { gen: 4900 }, "ÏôÑÎèÑ": { gen: 23000 }, "ÏßÑÎèÑ": { gen: 17800 }, "ÎÇ®ÏïÖ": { gen: 9700 } },
                    "Ïû•Ìù•": { "Í¥ëÏ£º": { gen: 11500, pre: 14900 }, "Î™©Ìè¨": { gen: 10200 }, "Ïó¨Ïàò": { gen: 16100 }, "ÏàúÏ≤ú": { gen: 11100 }, "ÎÇòÏ£º": { gen: 9000 }, "Í¥ëÏñë": { gen: 13200 }, "Îã¥Ïñë": { gen: 14400 }, "Í≥°ÏÑ±": { gen: 17000 }, "Íµ¨Î°Ä": { gen: 16300 }, "Í≥†Ìù•": { gen: 13100 }, "Î≥¥ÏÑ±": { gen: 3200 }, "ÌôîÏàú": { gen: 10000 }, "Í∞ïÏßÑ": { gen: 2400 }, "Ìï¥ÎÇ®": { gen: 5400 }, "ÏòÅÏïî": { gen: 4600 }, "Î¨¥Ïïà": { gen: 8500 }, "Ìï®Ìèâ": { gen: 7000 }, "ÏòÅÍ¥ë": { gen: 9800 }, "Ïû•ÏÑ±": { gen: 4900 }, "ÏôÑÎèÑ": { gen: 2300 }, "ÏßÑÎèÑ": { gen: 12700 }, "ÎÇ®ÏïÖ": { gen: 9700 } },
                    "Í∞ïÏßÑ": { "Í¥ëÏ£º": { gen: 11700, pre: 15200 }, "Î™©Ìè¨": { gen: 7800 }, "Ïó¨Ïàò": { gen: 18500 }, "ÏàúÏ≤ú": { gen: 13500 }, "ÎÇòÏ£º": { gen: 8200 }, "Í¥ëÏñë": { gen: 12700 }, "Îã¥Ïñë": { gen: 14600 }, "Í≥°ÏÑ±": { gen: 17200 }, "Íµ¨Î°Ä": { gen: 11400 }, "Ìï¥ÎÇ®": { gen: 13700 }, "ÏòÅÏïî": { gen: 8700 }, "Î¨¥Ïïà": { gen: 6000 }, "Ìï®Ìèâ": { gen: 4500 }, "ÏòÅÍ¥ë": { gen: 7300 }, "Ïû•ÏÑ±": { gen: 2400 }, "ÏôÑÎèÑ": { gen: 20500 }, "ÏßÑÎèÑ": { gen: 15300 }, "ÎÇ®ÏïÖ": { gen: 7200 } },
                    "Ìï¥ÎÇ®": { "Í¥ëÏ£º": { gen: 13700, pre: 16900 }, "Î™©Ìè¨": { gen: 8700 }, "Ïó¨Ïàò": { gen: 21500 }, "ÏàúÏ≤ú": { gen: 16600 }, "ÎÇòÏ£º": { gen: 9900 }, "Í¥ëÏñë": { gen: 19100 }, "Îã¥Ïñë": { gen: 16600 }, "Í≥°ÏÑ±": { gen: 19200 }, "Íµ¨Î°Ä": { gen: 21800 }, "Í≥†Ìù•": { gen: 18600 }, "Î≥¥ÏÑ±": { gen: 8700 }, "ÌôîÏàú": { gen: 16500 }, "Ïû•Ìù•": { gen: 5400 }, "Í∞ïÏßÑ": { gen: 3000 }, "ÏòÅÏïî": { gen: 4900 }, "Î¨¥Ïïà": { gen: 8500 }, "Ìï®Ìèâ": { gen: 7000 }, "ÏòÅÍ¥ë": { gen: 9800 }, "Ïû•ÏÑ±": { gen: 4900 }, "ÏôÑÎèÑ": { gen: 6700, pre: 8200 }, "ÏßÑÎèÑ": { gen: 7300 }, "ÎÇ®ÏïÖ": { gen: 8500 } },
                    "ÏòÅÏïî": { "Í¥ëÏ£º": { gen: 8700 }, "Î™©Ìè¨": { gen: 6400 }, "Ïó¨Ïàò": { gen: 22400 }, "ÏàúÏ≤ú": { gen: 17500 }, "ÎÇòÏ£º": { gen: 4400 }, "Í¥ëÏñë": { gen: 19500 }, "Îã¥Ïñë": { gen: 11600 }, "Í≥°ÏÑ±": { gen: 14200 }, "Íµ¨Î°Ä": { gen: 18500 }, "Í≥†Ìù•": { gen: 19500 }, "Î≥¥ÏÑ±": { gen: 7800 }, "ÌôîÏàú": { gen: 11200 }, "Ïû•Ìù•": { gen: 4600 }, "Í∞ïÏßÑ": { Ï†ïÎ≥¥: 3900 }, "Ìï¥ÎÇ®": { gen: 4900 }, "Î¨¥Ïïà": { gen: 9600 }, "Ìï®Ìèâ": { gen: 7700 }, "ÏòÅÍ¥ë": { gen: 11800 }, "Ïû•ÏÑ±": { gen: 11100 }, "ÏôÑÎèÑ": { gen: 11600 }, "ÏßÑÎèÑ": { gen: 10300 }, "ÎÇ®ÏïÖ": { gen: 3700 } },
                    "Î¨¥Ïïà": { "Í¥ëÏ£º": { gen: 6000, pre: 7800 }, "Î™©Ìè¨": { gen: 3200 }, "Ïó¨Ïàò": { gen: 19000 }, "ÏàúÏ≤ú": { gen: 14700, pre: 18200 }, "ÎÇòÏ£º": { gen: 4100 }, "Í¥ëÏñë": { gen: 14400 }, "Îã¥Ïñë": { gen: 8900 }, "Í≥°ÏÑ±": { gen: 11500 }, "Íµ¨Î°Ä": { gen: 15800 }, "Í≥†Ìù•": { gen: 22200 }, "Î≥¥ÏÑ±": { gen: 16700 }, "ÌôîÏàú": { gen: 8500 }, "Ïû•Ìù•": { gen: 13400 }, "Í∞ïÏßÑ": { gen: 11000 }, "Ìï¥ÎÇ®": { gen: 11900 }, "ÏòÅÏïî": { gen: 9600 }, "Ìï®Ìèâ": { gen: 2500 }, "ÏòÅÍ¥ë": { gen: 5500 }, "Ïû•ÏÑ±": { gen: 8400 }, "ÏôÑÎèÑ": { gen: 18900 }, "ÏßÑÎèÑ": { gen: 11500 }, "ÎÇ®ÏïÖ": { gen: 3700 } },
                    "Ìï®Ìèâ": { "Í¥ëÏ£º": { gen: 4500, pre: 5800 }, "Î™©Ìè¨": { gen: 5100 }, "Ïó¨Ïàò": { gen: 17500 }, "ÏàúÏ≤ú": { gen: 12900 }, "ÎÇòÏ£º": { gen: 3700 }, "Í¥ëÏñë": { gen: 12900 }, "Îã¥Ïñë": { ÏΩîÏä§Ìä∏: 7400 }, "Í≥°ÏÑ±": { gen: 8800 }, "Íµ¨Î°Ä": { gen: 14300 }, "Í≥†Ìù•": { gen: 20700 }, "Î≥¥ÏÑ±": { gen: 15000 }, "ÌôîÏàú": { gen: 7000 }, "Ïû•Ìù•": { gen: 15300 }, "Í∞ïÏßÑ": { gen: 11600 }, "Ìï¥ÎÇ®": { gen: 13800 }, "ÏòÅÏïî": { gen: 7700 }, "Î¨¥Ïïà": { gen: 2500 }, "ÏòÅÍ¥ë": { gen: 3600 }, "Ïû•ÏÑ±": { gen: 6900 }, "ÏôÑÎèÑ": { gen: 20800 }, "ÏßÑÎèÑ": { gen: 13400 }, "ÎÇ®ÏïÖ": { gen: 6800 } },
                    "ÏòÅÍ¥ë": { "Í¥ëÏ£º": { gen: 7300, pre: 9500 }, "Î™©Ìè¨": { gen: 8700 }, "Ïó¨Ïàò": { gen: 20300 }, "ÏàúÏ≤ú": { gen: 15700 }, "ÎÇòÏ£º": { gen: 7400 }, "Í¥ëÏñë": { gen: 15700 }, "Îã¥Ïñë": { gen: 10200 }, "Í≥°ÏÑ±": { gen: 12800 }, "Íµ¨Î°Ä": { gen: 17100 }, "Í≥†Ìù•": { gen: 23500 }, "Î≥¥ÏÑ±": { gen: 17800 }, "ÌôîÏàú": { gen: 9800 }, "Ïû•Ìù•": { gen: 18900 }, "Í∞ïÏßÑ": { gen: 16500 }, "Ìï¥ÎÇ®": { ÏΩîÏä§Ìä∏: 17400 }, "ÏòÅÏïî": { gen: 11800 }, "Î¨¥Ïïà": { gen: 5500 }, "Ìï®Ìèâ": { gen: 3600 }, "Ïû•ÏÑ±": { gen: 5900 }, "ÏôÑÎèÑ": { gen: 24400 }, "ÏßÑÎèÑ": { gen: 17000 }, "ÎÇ®ÏïÖ": { gen: 8700 } },
                    "Ïû•ÏÑ±": { "Í¥ëÏ£º": { gen: 2400 }, "Î™©Ìè¨": { gen: 9600 }, "Ïó¨Ïàò": { gen: 10800 }, "ÏàúÏ≤ú": { gen: 6700 }, "ÎÇòÏ£º": { gen: 10800 }, "Í¥ëÏñë": { gen: 5300 }, "Îã¥Ïñë": { gen: 7900 }, "Í≥°ÏÑ±": { gen: 12200 }, "Íµ¨Î°Ä": { gen: 18600 }, "Í≥†Ìù•": { gen: 12900 }, "Î≥¥ÏÑ±": { gen: 4900 }, "ÌôîÏàú": { gen: 13900 }, "Ïû•Ìù•": { gen: 14100 }, "Í∞ïÏßÑ": { gen: 16100 }, "Ìï¥ÎÇ®": { gen: 11100 }, "ÏòÅÏïî": { gen: 8400 }, "Î¨¥Ïïà": { gen: 6900 }, "Ìï®Ìèâ": { gen: 5900 }, "ÏòÅÍ¥ë": { gen: 9700 }, "ÏôÑÎèÑ": { gen: 22900 }, "ÏßÑÎèÑ": { gen: 14000 }, "ÎÇ®ÏïÖ": { gen: 15500 } },
                    "ÏôÑÎèÑ": { "Í¥ëÏ£º": { gen: 20500, pre: 24800 }, "Î™©Ìè¨": { gen: 15700 }, "Ïó¨Ïàò": { gen: 28200 }, "ÏàúÏ≤ú": { gen: 23200 }, "ÎÇòÏ£º": { gen: 16600 }, "Í¥ëÏñë": { gen: 25800 }, "Îã¥Ïñë": { gen: 23400 }, "Í≥°ÏÑ±": { gen: 23000 }, "Íµ¨Î°Ä": { gen: 28400 }, "Í≥†Ìù•": { gen: 25200 }, "Î≥¥ÏÑ±": { gen: 15400 }, "ÌôîÏàú": { gen: 23000 }, "Ïû•Ìù•": { gen: 12100 }, "Í∞ïÏßÑ": { gen: 7300 }, "Ìï¥ÎÇ®": { gen: 6700, pre: 8200 }, "ÏòÅÏïî": { gen: 11600 }, "Î¨¥Ïïà": { gen: 18900 }, "Ìï®Ìèâ": { gen: 20800 }, "ÏòÅÍ¥ë": { gen: 22900 }, "Ïû•ÏÑ±": { gen: 22900 }, "ÏßÑÎèÑ": { gen: 14000 }, "ÎÇ®ÏïÖ": { gen: 10100 } },
                    "ÏßÑÎèÑ": { "Í¥ëÏ£º": { gen: 15300, pre: 19900 }, "Î™©Ìè¨": { gen: 8300, pre: 10800 }, "Ïó¨Ïàò": { gen: 24800 }, "ÏàúÏ≤ú": { gen: 23900 }, "ÎÇòÏ£º": { gen: 17200 }, "Í¥ëÏñë": { gen: 23400 }, "Îã¥Ïñë": { gen: 18200 }, "Í≥°ÏÑ±": { gen: 20800 }, "Íµ¨Î°Ä": { gen: 11400 }, "Ìï¥ÎÇ®": { gen: 7300 }, "ÏòÅÏïî": { gen: 10300 }, "Î¨¥Ïïà": { gen: 11500 }, "Ìï®Ìèâ": { gen: 13400 }, "ÏòÅÍ¥ë": { Ï†ïÎ≥¥: 17000 }, "Ïû•ÏÑ±": { gen: 17700 }, "ÏôÑÎèÑ": { gen: 14000 }, "ÎÇ®ÏïÖ": { gen: 10100 } },
                    "ÎÇ®ÏïÖ": { "Í¥ëÏ£º": { gen: 7200, pre: 9300 }, "Î™©Ìè¨": { gen: 1700 }, "Ïó¨Ïàò": { gen: 15600, pre: 20200 }, "ÏàúÏ≤ú": { gen: 10600, pre: 13800 }, "ÎÇòÏ£º": { gen: 9000 }, "Í¥ëÏñë": { gen: 11700 }, "Îã¥Ïñë": { gen: 10100 }, "Í≥°ÏÑ±": { gen: 12700 }, "Íµ¨Î°Ä": { gen: 19000 }, "Í≥†Ìù•": { gen: 23400 }, "Î≥¥ÏÑ±": { gen: 13500 }, "ÌôîÏàú": { gen: 9700 }, "Ïû•Ìù•": { gen: 10000 }, "Í∞ïÏßÑ": { gen: 7600 }, "Ìï¥ÎÇ®": { gen: 8500 }, "ÏòÅÏïî": { gen: 3700 }, "Î¨¥Ïïà": { gen: 3700 }, "Ìï®Ìèâ": { gen: 6800 }, "ÏòÅÍ¥ë": { gen: 8700 }, "Ïû•ÏÑ±": { gen: 9600 }, "ÏôÑÎèÑ": { gen: 15500 }, "ÏßÑÎèÑ": { gen: 10100 } } 
                };

                const expandedData = JSON.parse(INITIAL_DATA ? JSON.stringify(INITIAL_DATA) : '{}');
                Object.keys(INITIAL_DATA).forEach(from => {
                    Object.keys(INITIAL_DATA[from]).forEach(to => {
                        if (!expandedData[to]) expandedData[to] = {};
                        if (!expandedData[to][from]) expandedData[to][from] = INITIAL_DATA[from][to];
                    });
                });
                setBusDataState(expandedData);

                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const performCalculation = (o = origin, d = destination) => {
                const from = normalize(o);
                const to = normalize(d);
                setDeductions({ gov_vehicle: false, meal_1: false, meal_2: false, meal_3: false, meal_half: false, transport_proof: false, transport_gov_vehicle: false, transport_passenger: false });
                setShipFare(0); setManualMainTransport(null);
                setShowDetail(false);
                
                const fromNormalized = o.replace(/\s/g, "");
                const toNormalized = d.replace(/\s/g, "");

                if (POPUP_REGIONS[fromNormalized] && !modalState.type) {
                    setModalState({ type: 'origin', data: POPUP_REGIONS[fromNormalized] });
                    return;
                }
                if (POPUP_REGIONS[toNormalized] && !modalState.type) {
                    setModalState({ type: 'destination', data: POPUP_REGIONS[toNormalized] });
                    return;
                }

                if (!from || !to) return;
                for (const group of SAME_AREA_GROUPS) {
                    if (group.has(from) && group.has(to)) {
                        setIntraCityOpen(true);
                        return;
                    }
                }
                if (Object.keys(busDataState).length === 0) return;
                const fromIsland = ISLAND_DB[from];
                const toIsland = ISLAND_DB[to];
                let searchFrom = from; let searchTo = to; let surcharge = 0; let shipSurcharge = 0; let viaPoint = null; let islandConfig = null; let isShipOnlyRoute = false;
                if (fromIsland) { searchFrom = fromIsland.hub; shipSurcharge += (fromIsland.shipCost || 0); islandConfig = fromIsland; viaPoint = fromIsland.via || fromIsland.hub; }
                if (toIsland) { searchTo = toIsland.hub; shipSurcharge += (toIsland.shipCost || 0); islandConfig = toIsland; viaPoint = toIsland.via || toIsland.hub; }
                
                const mainlandCities = ["Í¥ëÏ£º", "Î™©Ìè¨", "ÎÇ®ÏïÖ", "ÎÇòÏ£º", "Î¨¥Ïïà", "Ìï®Ìèâ", "ÏòÅÍ¥ë", "ÏàúÏ≤ú", "Ïó¨Ïàò", "Ïû•ÏÑ±", "Îã¥Ïñë", "Í≥°ÏÑ±", "Íµ¨Î°Ä", "Í¥ëÏñë", "Î≥¥ÏÑ±", "ÌôîÏàú", "Ïû•Ìù•", "Í∞ïÏßÑ", "Ìï¥ÎÇ®", "ÏòÅÏïî"];
                const fromIsIsland = !!fromIsland;
                const toIsIsland = !!toIsland;
                const fromIsMainland = mainlandCities.includes(from);
                const toIsMainland = mainlandCities.includes(to);
                
                if (fromIsMainland && toIsIsland && toIsland.hub === "Î™©Ìè¨") {
                    surcharge = toIsland.cost || 0;
                } else if (fromIsIsland && fromIsland.hub === "Î™©Ìè¨" && toIsMainland) {
                    surcharge = fromIsland.cost || 0;
                } else {
                    surcharge = 0;
                }

                const baseData = busDataState[searchFrom]?.[searchTo];
                if (baseData || (searchFrom === searchTo)) {
                    const finalGen = (baseData?.gen || 0) + surcharge;
                    const finalPre = baseData?.pre ? baseData.pre + surcharge : null;
                    const finalCost = finalPre ? finalPre : finalGen;
                    setShipFare(shipSurcharge * 2);
                    setManualMainTransport(finalCost * 2);
                    if (islandConfig && islandConfig.type === 'ship') isShipOnlyRoute = true;
                    setResult({ type: 'internal', cost: finalCost, baseBusCost: baseData?.pre || baseData?.gen || 0, routeType: (islandConfig && searchFrom !== searchTo) ? 'transfer' : 'direct', viaPoint, surcharge, shipCost: shipSurcharge, isShipOnlyRoute, isShinanRoute: (searchFrom === "Î™©Ìè¨" || searchTo === "Î™©Ìè¨") && surcharge > 0 });
                    
                    const fromConfig = ISLAND_DB[from];
                    const toConfig = ISLAND_DB[to];
                    if (fromConfig?.type === 'ship' || toConfig?.type === 'ship') {
                        setShowDetail(true);
                    }
                } else { setResult({ type: 'external' }); }
            };

            const calculateDetailedCost = () => {
                if (!result) return { total: 0 };
                let daily = deductions.gov_vehicle ? 12500 : 25000;
                let meal = deductions.meal_3 ? 0 : deductions.meal_1 ? 16660 : deductions.meal_2 ? 8330 : deductions.meal_half ? 12500 : 25000;
                let transport = 0;
                const isTransportDeducted = deductions.transport_proof || deductions.transport_gov_vehicle || deductions.transport_passenger;
                if (!isTransportDeducted) {
                    transport = result.type === 'internal' ? Number(manualMainTransport) : (Number(customTransport) || 0);
                }
                return { daily, meal, transport, total: daily + meal + transport + (shipFare || 0) };
            };

            const getRouteTags = () => {
                const tags = [];
                if (!result || result.type !== 'internal') return tags;
                if (deductions.gov_vehicle || deductions.transport_gov_vehicle) { tags.push({ label: 'Í¥ÄÏö©Ï∞®Îüâ', type: 'dark' }); } 
                else { tags.push({ label: 'ÏûêÍ∞ÄÏö©', type: 'dark' }); }
                if (result.routeType === 'transfer') tags.push({ label: `${result.viaPoint} Í≤ΩÏú†`, type: 'light' });
                const normOrigin = normalize(origin); const normDest = normalize(destination);
                const fromConfig = ISLAND_DB[normOrigin]; const toConfig = ISLAND_DB[normDest];
                const isWandoConnected = (c) => c && c.hub === 'ÏôÑÎèÑ' && c.type === 'connected';
                const isEoryongdo = normOrigin === 'Ìï¥ÎÇ®Ïñ¥Î£°ÎèÑ' || normDest === 'Ìï¥ÎÇ®Ïñ¥Î£°ÎèÑ';
                const showBus = !isEoryongdo && ((fromConfig?.type === 'connected' && !isWandoConnected(fromConfig)) || (toConfig?.type === 'connected' && !isWandoConnected(toConfig)) || (result.surcharge > 0 && !isWandoConnected(fromConfig) && !isWandoConnected(toConfig)));
                const showShip = fromConfig?.type === 'ship' || toConfig?.type === 'ship';
                if (showBus) tags.push({ label: 'ÎÜçÏñ¥Ï¥åÎ≤ÑÏä§', type: 'light' });
                if (isEoryongdo) tags.push({ label: 'Í∏∞ÌÉÄÍµêÌÜµÎπÑ', type: 'light' });
                if (showShip) tags.push({ label: 'Ïó¨Í∞ùÏÑ†', type: 'light' });
                tags.push({ label: 'ÎãπÏùº', type: 'light' });
                return tags;
            };

            const detailCosts = calculateDetailedCost();
            const isTransportDeductedVar = deductions.transport_proof || deductions.transport_gov_vehicle || deductions.transport_passenger;
            const routeTags = getRouteTags();

            return (
                <div className="main-wrapper font-pretendard">
                    <header className={`flex items-center justify-between px-6 iphone-dark-header sticky top-0 z-40 transition-all duration-500 h-[100px] ${isHeaderVisible ? 'translate-y-0 opacity-100' : '-translate-y-full opacity-0 overflow-hidden'}`}>
                        <div className="flex flex-col">
                            <h1 className="font-extrabold text-2xl text-white tracking-tighter shadow-sm">yeobi-easier</h1>
                            <span className="text-[10px] font-bold text-gray-400 mt-0.5 tracking-widest ml-0.5">by JHN</span>
                        </div>
                        <button 
                            onClick={() => setIntraCityOpen(true)} 
                            className="btn-metallic-red w-[64px] h-[64px] rounded-full flex flex-col items-center justify-center active:scale-90 transition-all shadow-2xl border-2 border-red-900 focus:outline-none"
                        >
                            <span className="text-[12px] font-black leading-tight">Í¥ÄÎÇ¥</span>
                            <span className="text-[12px] font-black leading-tight">Ï∂úÏû•</span>
                        </button>
                    </header>

                    <main className="flex-1 p-5 pt-8 overflow-y-auto">
                        <div className="space-y-5 mb-8">
                            <AutocompleteInput placeholder="Ï∂úÎ∞úÏßÄ (Ïòà: Í¥ëÏ£º)" value={origin} onChange={setOrigin} cityList={ALLOWED_CITIES} onSelect={(city) => { setOrigin(city); const norm = city.replace(/\s/g, ""); if(POPUP_REGIONS[norm]) setModalState({ type: 'origin', data: POPUP_REGIONS[norm] }); else if (destination) performCalculation(city, destination); }} />
                            <AutocompleteInput placeholder="ÎèÑÏ∞©ÏßÄ (Ïòà: ÎπÑÍ∏à)" value={destination} onChange={setDestination} cityList={ALLOWED_CITIES} onSelect={(city) => { setDestination(city); const norm = city.replace(/\s/g, ""); if(POPUP_REGIONS[norm]) setModalState({ type: 'destination', data: POPUP_REGIONS[norm] }); else if (origin) performCalculation(origin, city); }} />
                            <button onClick={() => performCalculation()} className="btn-metallic-blue w-full h-14 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg focus:ring-2 focus:ring-blue-400 outline-none">
                                <Icons.Search size={22} /> Ï°∞ÌöåÌïòÍ∏∞
                            </button>
                        </div>
                        <div className="min-h-[220px]">
                            {result && (
                                <div className="glass-panel p-5 animate-slide-up pb-10">
                                    <div className="pb-3 flex flex-wrap justify-center gap-1 mb-5 border-b border-gray-100">
                                        {routeTags.map((tag, idx) => (<span key={idx} className={`tag-badge ${tag.type === 'dark' ? 'tag-badge-dark' : ''}`}>{tag.label}</span>))}
                                    </div>
                                    <div className="py-2 px-4 space-y-2">
                                        {result.type === 'internal' ? (
                                            <>
                                                <div className="flex justify-between items-center py-1 h-8">
                                                    <div className="flex items-center">
                                                        <span className="text-[20px] font-bold text-teal-800">ÏöîÍ∏à</span>
                                                        <span className="tag-side">Ìé∏ÎèÑ</span>
                                                    </div>
                                                    <span className="text-[20px] font-bold text-teal-800">{fmt(result.isShinanRoute ? result.baseBusCost : result.cost)}Ïõê</span>
                                                </div>
                                                {result.isShinanRoute && result.surcharge > 0 && (
                                                    <div className="flex justify-between items-center py-1 h-8">
                                                        <div className="flex items-center">
                                                            <span className="text-[20px] font-bold text-blue-700">ÎÜçÏñ¥Ï¥åÎ≤ÑÏä§</span>
                                                            <span className="tag-side">Ìé∏ÎèÑ</span>
                                                        </div>
                                                        <span className="text-[20px] font-bold text-blue-700">{fmt(result.surcharge)}Ïõê</span>
                                                    </div>
                                                )}
                                            </>
                                        ) : <div className="text-lg font-bold text-gray-400 mb-2 text-center py-2">Ïô∏Î∂Ä Í≤ÄÏÉâ ÌïÑÏöî</div>}
                                        
                                        <button 
                                            onClick={() => setShowDetail(!showDetail)} 
                                            className={`w-full mt-6 h-14 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition-all focus:ring-2 focus:ring-teal-400 outline-none ${showDetail ? 'bg-green-50 text-teal-700 border border-teal-100 shadow-inner' : 'btn-metallic-teal animate-pulse-spread'}`}
                                        >
                                            <span>Ïó¨ÎπÑ Í≥ÑÏÇ∞ÌïòÍ∏∞</span>
                                            <Icons.ChevronDown className={`transition-transform duration-300 ${showDetail ? 'rotate-180' : ''}`} size={20} />
                                        </button>
                                    </div>
                                    <div className={`detail-drawer ${showDetail ? 'open' : ''}`}>
                                        <div className="p-4 pt-10 space-y-6">
                                            <div className="relative flex items-center justify-between h-10"><span className="text-[18px] font-bold text-gray-700 w-24">ÏùºÎπÑ</span><button onClick={() => setActiveModal('daily')} className={`deduct-btn ${deductions.gov_vehicle ? 'active' : ''} animate-pulse-spread`}>Í∞êÏï°</button><span className="text-[18px] font-bold text-gray-900 text-right flex-1">{fmt(detailCosts.daily)}Ïõê</span></div>
                                            <div className="relative flex items-center justify-between h-10"><span className="text-[18px] font-bold text-gray-700 w-24">ÏãùÎπÑ</span><button onClick={() => setActiveModal('meal')} className={`deduct-btn ${(deductions.meal_1 || deductions.meal_2 || deductions.meal_3 || deductions.meal_half) ? 'active' : ''} animate-pulse-spread`}>Í∞êÏï°</button><span className="text-[18px] font-bold text-gray-900 text-right flex-1">{fmt(detailCosts.meal)}Ïõê</span></div>
                                            <div className="pt-2 border-t border-dashed border-gray-300">
                                                <div className="relative flex flex-col py-2 h-auto">
                                                    <div className="flex items-center justify-between h-10 w-full relative"><div className="flex items-center w-32"><span className="text-[18px] font-bold text-gray-700">ÍµêÌÜµÎπÑ</span><span className="tag-side">ÏôïÎ≥µ</span></div><button onClick={() => setActiveModal('transport')} className={`deduct-btn ${isTransportDeductedVar ? 'active' : ''} animate-pulse-spread`}>Í∞êÏï°</button><div className="text-right flex-1">{!isTransportDeductedVar ? <div className="flex items-center justify-end gap-1"><input type="text" inputMode="numeric" value={manualMainTransport === null ? '' : fmt(manualMainTransport)} onChange={(e) => { const val = e.target.value.replace(/,/g, ''); if (val === '' || !isNaN(val)) setManualMainTransport(Number(val)); }} className="ship-fare-input text-[18px] w-28 text-right font-bold" /><span className="text-[18px] text-gray-900 font-bold">Ïõê</span></div> : <span className="text-[18px] font-bold text-gray-400">0Ïõê</span>}</div></div>
                                                    {result.surcharge > 0 && !isTransportDeductedVar && <div className="w-full text-right mt-1"><span className="text-[11px] text-blue-500 font-medium font-pretendard">ÎÜçÏñ¥Ï¥åÎ≤ÑÏä§ {fmt(result.surcharge * 2)}Ïõê Ìè¨Ìï®</span></div>}
                                                </div>
                                                {(result.isShipOnlyRoute || shipFare > 0) && (
                                                    <div className="relative flex flex-col py-2 mt-1 h-auto">
                                                        <div className="flex items-center justify-between h-10 w-full relative">
                                                            <div className="flex items-center w-40">
                                                                <span className="text-[18px] font-bold text-gray-600 tracking-tight">Í∏∞ÌÉÄÍµêÌÜµÎπÑ</span>
                                                                <span className="text-lg ml-1">üö¢</span>
                                                            </div>
                                                            <div className="deduct-btn invisible">Í∞êÏï°</div>
                                                            <div className="text-right flex-1">
                                                                <div className="flex items-center justify-end gap-1">
                                                                    <input type="text" inputMode="numeric" value={shipFare === 0 ? '' : fmt(shipFare)} onChange={(e) => { const val = e.target.value.replace(/,/g, ''); if (val === '' || !isNaN(val)) setShipFare(Number(val)); }} placeholder="0" className="ship-fare-input text-[18px] w-28 text-right font-bold" />
                                                                    <span className="text-[18px] text-gray-600 font-bold">Ïõê</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        {shipFare > 0 && (<div className="w-full text-right mt-1"><span className="text-[11px] text-blue-500 font-medium font-pretendard">Ïó¨Í∞ùÏÑ† {fmt(shipFare)}Ïõê Ìè¨Ìï®</span></div>)}
                                                    </div>
                                                )}
                                            </div>
                                            <div className="pt-4 border-t-2 border-gray-400 flex justify-between items-center"><span className="font-bold text-gray-900 text-[18px]">Ï¥ù ÏßÄÍ∏âÏï°</span><span className="text-[22px] font-bold text-teal-700">{fmt(detailCosts.total)}<span className="text-[18px] text-teal-700 ml-1">Ïõê</span></span></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                        
                        <div className="mt-12 space-y-4">
                            <a href="https://padlet.com/jbyhee/hyonu-s-padlet-4m26339lwedx23dc" target="_blank" rel="noopener noreferrer" 
                               className="btn-metallic-slate w-full h-14 rounded-xl font-bold text-[19px] flex items-center justify-center gap-2 shadow-lg hover:scale-[1.02] transition-transform">
                                <span>üí¨ Ï†ïÎ≥¥ ÏàòÏ†ï Î∞è Í±¥Ïùò (Padlet)</span>
                            </a>
                            <p className="text-[11px] font-bold text-gray-500 text-center font-pretendard">Crafted with Passion by Ï†ÑÌòÑÏö∞@Ïö∞ÏàòÏòÅÏ¥àÎì±ÌïôÍµê</p>
                        </div>
                    </main>

                    {intraCityOpen && (
                        <div className="fixed inset-0 z-[110] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200" onClick={() => setIntraCityOpen(false)}>
                            <div className="bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden animate-slide-up" onClick={e => e.stopPropagation()}>
                                <div className="p-6">
                                    <div className="flex justify-between items-center mb-6"><h3 className="font-bold text-xl text-gray-800">Í¥ÄÎÇ¥ Ï∂úÏû• Ïó¨ÎπÑ (Ï∞∏Í≥†)</h3><button onClick={() => setIntraCityOpen(false)} className="text-gray-400 hover:text-gray-600"><Icons.X size={22} /></button></div>
                                    <div className="space-y-5">
                                        <div className="flex justify-between items-center py-2 border-b border-gray-100"><span className="text-lg font-bold text-gray-700">Í∏∞Î≥∏ Ï†ïÏï°</span><span className="text-lg font-bold text-gray-900">20,000Ïõê</span></div>
                                        <div className="flex justify-between items-center py-2"><span className="text-base font-bold text-gray-600">4ÏãúÍ∞Ñ ÎØ∏Îßå (¬Ω Í∞êÏï°)</span><Toggle checked={intraDeductions.shortTime} onChange={(val) => setIntraDeductions(p => ({...p, shortTime: val}))} /></div>
                                        <div className="flex justify-between items-center py-2"><span className="text-base font-bold text-gray-600">Í¥ÄÏö©Ï∞®Îüâ Ïù¥Ïö© (¬Ω Í∞êÏï°)</span><Toggle checked={intraDeductions.govVehicle} onChange={(val) => setIntraDeductions(p => ({...p, govVehicle: val}))} /></div>
                                        <div className="mt-8 pt-6 border-t-2 border-gray-200 flex justify-between items-center"><span className="text-xl font-bold text-gray-900">ÏßÄÍ∏â ÎåÄÏÉÅÏï°</span><span className="text-2xl font-bold text-blue-600">{fmt(20000 - (intraDeductions.shortTime ? 10000 : 0) - (intraDeductions.govVehicle ? 10000 : 0))}Ïõê</span></div>
                                    </div>
                                    <button onClick={() => setIntraCityOpen(false)} className="btn-metallic-blue w-full mt-10 h-14 rounded-xl font-bold text-lg text-white">Îã´Í∏∞</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeModal && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" onClick={() => setActiveModal(null)}>
                            <div className="bg-white w-full max-w-sm rounded-2xl shadow-2xl animate-slide-up overflow-y-auto max-h-[90vh]" onClick={e => e.stopPropagation()}>
                                <div className="p-5">
                                    <div className="flex justify-between items-center mb-4"><h3 className="font-bold text-2xl text-gray-800">{activeModal === 'daily' ? 'ÏùºÎπÑ' : activeModal === 'meal' ? 'ÏãùÎπÑ' : 'ÍµêÌÜµÎπÑ'}</h3><button onClick={() => setActiveModal(null)}><Icons.X size={24} className="text-gray-400" /></button></div>
                                    <div className="mb-6 text-base text-gray-600 leading-relaxed font-medium">
                                        {activeModal === 'daily' && `Ï∂úÏû•ÏßÄ(${destination || 'Ìï¥ÎÇ®'}) ÎÇ¥ÏóêÏÑú ÏÜåÏöîÎêòÎäî ÍµêÌÜµÎπÑ, ÌÜµÏã†ÎπÑ, ÏùåÎ£åÎπÑ Îì±`}
                                        {activeModal === 'meal' && `ÏãùÏÇ¨Ïóê ÏÜåÏöîÎêòÎäî ÎπÑÏö©(Ïù¥Ìïò Í∞êÏï° ÏÇ¨Ïú†)`}
                                        {activeModal === 'transport' && `ÎèÑÏ∞©ÏßÄ(${destination || 'Ìï¥ÎÇ®'})Î°ú Ïù¥ÎèôÌïòÍ∏∞ ÏúÑÌïú Ïú°ÏÉÅ ÍµêÌÜµÏàòÎã®Ïùò ÎπÑÏö©`}
                                    </div>
                                    {activeModal === 'meal' && (
                                        <ul className="mb-6 space-y-2 text-base text-gray-500 font-bold ml-1">
                                            <li className="flex gap-2"><span>‚Ä¢</span><span>Ïó∞Ïàò, ÌòëÏùòÌöå, ÌñâÏÇ¨ Ï£ºÏ≤¥ Ï∏°ÏóêÏÑú ÏãùÏÇ¨ Ï†úÍ≥µ</span></li>
                                            <li className="flex gap-2"><span>‚Ä¢</span><span>ÏòàÏÇ∞(Í≥ÑÏïΩ)ÏúºÎ°ú ÏãùÎπÑÍ∞Ä Ïù¥ÎØ∏ ÏßÄÏ∂ú</span></li>
                                            <li className="flex gap-2"><span>‚Ä¢</span><span>ÏóÖÎ¨¥Ï∂îÏßÑÎπÑÎ°ú ÏãùÏÇ¨Î•º Ìï¥Í≤∞Ìïú Í≤ΩÏö∞</span></li>
                                            <li className="flex gap-2"><span>‚Ä¢</span><span>Ï§ëÎ≥µÏßÄÍ∏â Î∞©ÏßÄ</span></li>
                                            <li className="text-sm text-gray-400 font-medium pl-4 leading-normal italic">
                                                Ïòà) Ïò§Ï†Ñ Í¥ÄÎÇ¥ Ï∂úÏû•Í≥º Ïò§ÌõÑ Í¥ÄÏô∏ Ï∂úÏû•Ïù¥ Í≤πÏπòÎäî Í≤ΩÏö∞, ÌÜµÏÉÅÏ†ÅÏù∏ ÏãùÏÇ¨ ÏãúÍ∞ÑÍ≥º Ï∂úÏû• ÏãúÍ∞ÑÏùÑ Í≥†Î†§, Í¥ÄÏô∏ Ï∂úÏû• ÏãùÎπÑÏùò 1/2 ÎòêÎäî 2/3Î•º Í∞êÏï°ÌïòÏó¨ ÏßÄÍ∏â.
                                            </li>
                                        </ul>
                                    )}
                                    {activeModal === 'transport' && (
                                        <div className="mb-6 p-4 bg-gray-50 rounded-xl border border-gray-100 text-sm leading-relaxed font-bold text-gray-500 shadow-inner">
                                            Ï£ºÏú†ÏòÅÏàòÏ¶ù(Ï∂úÏû•ÏßÄ), ÌÜµÌñâÏòÅÏàòÏ¶ù(ÌïòÏù¥Ìå®Ïä§), <span className="text-gray-300">ÏäπÏ∞®Í∂å, Ïã†Ïö©Ïπ¥ÎìúÎß§Ï∂úÏ†ÑÌëú Îì±</span>
                                        </div>
                                    )}
                                    <div className="space-y-4">
                                        {(activeModal === 'daily' ? [ { id: 'gov_vehicle', label: "Í¥ÄÏö©Ï∞®Îüâ Ïù¥Ïö© : ÏùºÎπÑÏùò ¬Ω Í∞êÏï°", subLabel: "(ÏûÑÏ∞®Î≤ÑÏä§, ÌÜµÌïôÎ≤ÑÏä§ Îì±)" } ] :
                                          activeModal === 'meal' ? [ { id: 'meal_1', label: "1Ïãù Í∞êÏï°" }, { id: 'meal_2', label: "2Ïãù Í∞êÏï°" }, { id: 'meal_3', label: "Ï†ÑÏï° Í∞êÏï°" }, { id: 'meal_half', label: "¬Ω Í∞êÏï°" } ] :
                                          [ { id: 'transport_proof', label: "Ï¶ùÍ±∞ÏÑúÎ•òÏùò ÎØ∏Ï†úÏ∂ú¬∑Î∂ÄÏ†ÅÏ†ï" }, { id: 'transport_gov_vehicle', label: "Í≥µÏö©Ï∞®ÎüâÏù¥ÎÇò ÏûÑÏ∞®Ï∞®Îüâ Îì±ÏùÑ Ïù¥Ïö©Ìïú Í≤ΩÏö∞" }, { id: 'transport_passenger', label: "ÎèôÎ£åÏùò Ï∞®ÎüâÏóê ÎèôÏäπÌïú Í≤ΩÏö∞", subLabel: "ÎèôÏäπÏûêÏóêÍ≤åÎäî ÍµêÌÜµÎπÑÎ•º ÏßÄÍ∏âÌïòÏßÄ ÏïäÏùå" } ]
                                        ).map(item => (<div key={item.id} className="flex justify-between items-center py-3 border-b border-gray-100 last:border-0">
                                            <div>
                                                <span className="block text-base font-extrabold text-gray-800 leading-tight">{item.label}</span>
                                                {item.subLabel && <span className="text-sm text-gray-400 mt-1 block font-bold">{item.subLabel}</span>}
                                            </div>
                                            <Toggle checked={deductions[item.id]} onChange={() => {
                                                const id = item.id;
                                                setDeductions(prev => {
                                                    const newState = { ...prev };
                                                    if (['meal_1', 'meal_2', 'meal_3', 'meal_half'].includes(id)) { if (!prev[id]) { newState['meal_1'] = false; newState['meal_2'] = false; newState['meal_3'] = false; newState['meal_half'] = false; } }
                                                    newState[id] = !prev[id];
                                                    if (id === 'gov_vehicle') newState['transport_gov_vehicle'] = newState[id];
                                                    if (id === 'transport_gov_vehicle') newState['gov_vehicle'] = newState[id];
                                                    return newState;
                                                });
                                            }} />
                                        </div>))}
                                    </div>
                                    <button onClick={() => setActiveModal(null)} className="btn-metallic-blue w-full mt-8 h-12 rounded-xl font-bold text-lg text-white">ÌôïÏù∏</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {modalState.type && (
                        <div className="fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200" onClick={() => setModalState({ type: null, data: [] })}>
                            <div className="bg-white rounded-2xl w-full max-w-sm shadow-2xl overflow-hidden animate-slide-up" onClick={e => e.stopPropagation()}>
                                <div className="bg-slate-800 p-4 flex items-center justify-between text-white"><h2 className="font-bold">ÏÑ∏Î∂Ä ÏßÄÏó≠ ÏÑ†ÌÉù</h2><button onClick={() => setModalState({ type: null, data: [] })}><Icons.X size={20} /></button></div>
                                <div className="p-4 grid grid-cols-3 gap-2 max-h-[75vh] overflow-y-auto custom-scroll">
                                    {modalState.data.map((name, idx) => (
                                        <button key={name} onClick={() => { if (modalState.type === 'origin') { setOrigin(name); if (destination) performCalculation(name, destination); } else { setDestination(name); if (origin) performCalculation(origin, name); } setModalState({ type: null, data: [] }); }} 
                                                className="flex flex-col items-center justify-center gap-1 px-1 py-3 rounded-lg bg-gray-50 border border-gray-100 transition-all hover:bg-teal-50 active:scale-95 outline-none">
                                            <span className="text-xl">{REGION_ICONS[name.replace(/\s/g, "")]}</span>
                                            <span className="text-[11px] font-bold text-gray-700 break-keep text-center">{name}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
