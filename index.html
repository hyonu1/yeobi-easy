<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>yeobi_easy for KOR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --color-teal: #00BFA5; --font-pretendard: 'Pretendard', sans-serif; }
        body { font-family: var(--font-pretendard); background-color: #F7F9FB; -webkit-font-smoothing: antialiased; }
        .btn-primary { background-color: var(--color-teal); color: white; transition: all 0.2s; }
        .result-card { background-color: #FFFFFF; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // 2026 전남 교육행정 여비 규정
        const CONFIG = {
            VWORLD_KEY: "9F33F28D-CE1C-3EC7-97B1-02372785C3D5",
            OUT_DAILY: 25000,   // 관외 일비 인상분
            OUT_MEAL: 25000,    // 관외 식비
            IN_DAILY_LONG: 20000, // 관내 (4시간 이상)
            IN_DAILY_SHORT: 10000 // 관내 (4시간 미만)
        };

        const App = () => {
            const [origin, setOrigin] = useState('');
            const [destination, setDestination] = useState('');
            const [coords, setCoords] = useState({ start: null, end: null });
            const [travelType, setTravelType] = useState('OUT');
            const [showDetail, setShowDetail] = useState(false);
            const [deductions, setDeductions] = useState({ gov_vehicle: false, short_time: false, meal_count: 0 });

            // Vworld 주소 -> 좌표 변환 함수
            const getCoords = async (address, type) => {
                const url = `https://api.vworld.kr/req/address?service=address&request=getcoord&version=2.0&crs=epsg:4324&address=${encodeURIComponent(address)}&refine=true&simple=false&format=json&type=road&key=${CONFIG.VWORLD_KEY}`;
                
                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    if (data.response.status === "OK") {
                        const { x, y } = data.response.result.point;
                        setCoords(prev => ({ ...prev, [type]: { x, y } }));
                        alert(`${address} 좌표 확보 완료: ${x}, ${y}`);
                    } else {
                        alert("주소를 정확히 입력해주세요.");
                    }
                } catch (error) {
                    alert("좌표 변환 중 오류가 발생했습니다.");
                }
            };

            const costs = (() => {
                let daily = travelType === 'OUT' ? CONFIG.OUT_DAILY : (deductions.short_time ? CONFIG.IN_DAILY_SHORT : CONFIG.IN_DAILY_LONG);
                if (deductions.gov_vehicle) daily = travelType === 'OUT' ? daily / 2 : daily - 10000; //
                let meal = travelType === 'OUT' ? CONFIG.OUT_MEAL - (deductions.meal_count * 8330) : 0; //
                return { daily, meal, transport: 0 }; // 현재 좌표만 확보한 상태
            })();

            return (
                <div className="max-w-[480px] mx-auto p-5 min-h-screen">
                    <header className="text-center mb-8">
                        <h1 className="text-xl font-bold text-gray-900">yeobi_easy for KOR</h1>
                        <p className="text-[10px] font-bold text-teal-500">Vworld Geocoding Engine</p>
                    </header>

                    <div className="space-y-4 mb-6">
                        <div className="bg-white p-4 rounded-2xl shadow-sm flex gap-2">
                            <input type="text" className="flex-1 outline-none font-bold" placeholder="출발지 (읍/면/동)" value={origin} onChange={e => setOrigin(e.target.value)} />
                            <button onClick={() => getCoords(origin, 'start')} className="text-xs font-bold text-teal-600 bg-teal-50 px-3 py-1 rounded-lg">좌표찾기</button>
                        </div>
                        <div className="bg-white p-4 rounded-2xl shadow-sm flex gap-2">
                            <input type="text" className="flex-1 outline-none font-bold" placeholder="목적지 (읍/면/동)" value={destination} onChange={e => setDestination(e.target.value)} />
                            <button onClick={() => getCoords(destination, 'end')} className="text-xs font-bold text-teal-600 bg-teal-50 px-3 py-1 rounded-lg">좌표찾기</button>
                        </div>
                        <div className="flex gap-2">
                            {['IN', 'OUT'].map(type => (
                                <button key={type} onClick={() => setTravelType(type)} className={`flex-1 p-3 rounded-xl font-bold text-sm ${travelType === type ? 'bg-teal-500 text-white' : 'bg-gray-100 text-gray-400'}`}>{type === 'IN' ? '관내' : '관외'}</button>
                            ))}
                        </div>
                    </div>

                    <div className="result-card p-8 mb-6 text-center">
                        <span className="text-[10px] font-bold text-gray-400">좌표 기반 여비 가이드</span>
                        <h2 className="text-3xl font-black text-gray-900 mt-4">좌표 확보 완료</h2>
                        <p className="text-[10px] text-gray-400 mt-2">출발: {coords.start?.x || '0'}, 도착: {coords.end?.x || '0'}</p>
                        <button onClick={() => setShowDetail(!showDetail)} className="w-full mt-6 py-4 btn-primary rounded-2xl font-bold text-sm">상세 여비 확인</button>
                    </div>

                    {showDetail && (
                        <div className="bg-white rounded-3xl p-6 shadow-xl border border-teal-50">
                            <h3 className="font-bold text-gray-800 mb-4">실무 정산 내역</h3>
                            <div className="space-y-3 text-sm">
                                <div className="flex justify-between"><span>일비 (관용차 {deductions.gov_vehicle ? 'O' : 'X'})</span><span className="font-bold">{costs.daily.toLocaleString()}원</span></div>
                                <div className="flex justify-between"><span>식비 (감액 {deductions.meal_count}식)</span><span className="font-bold">{costs.meal.toLocaleString()}원</span></div>
                                <div className="pt-4 border-t border-dashed flex justify-between font-black text-teal-600"><span>예상 합계</span><span>{(costs.daily + costs.meal).toLocaleString()}원</span></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
